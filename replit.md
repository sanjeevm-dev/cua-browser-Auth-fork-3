# Salesman.sh - Autonomous Agent Platform

## Overview
Salesman.sh is a platform for building and deploying intelligent autonomous agents focused on sales automation. It enables users to create multi-day, Computer-Use-Agent (CUA) ready campaigns for tasks like lead generation, prospecting, outreach, and CRM management. The platform aims to boost sales productivity through natural language agent creation, pre-built templates, and a dynamic split-screen builder interface. The project's ambition is to streamline sales operations and enhance efficiency using AI-driven automation.

## User Preferences
I prefer detailed explanations.
I want iterative development.
Ask before making major changes.

## System Architecture

### UI/UX Decisions
The platform features a dark theme with a pure black background, glassmorphism effects, and blue accents. Key UI components include a home screen with centered natural language input, a split-screen Agent Builder (conversational AI on the left, configuration on the right), and an interactive node panel. It utilizes a universal authentication system, a Dashboard for managing deployed agents, subtle toast notifications, visual validation indicators, and a collapsible sidebar. Design elements include rounded corners and subtle gradients. The "Workflow" tab visually displays the agent's execution plan, and daily tasks are presented in an accordion interface. Custom scrollbar styling ensures a consistent dark theme aesthetic.

**Responsive Design**: The platform is fully responsive across mobile (<768px), tablet (768-1024px), and desktop (>1024px) devices. Mobile UX follows industry standards with minimum 44px touch targets, no horizontal scroll, and safe-area support for notched devices. The sidebar converts to a mobile drawer with overlay and slide-in animation. The TopBar features a mobile hamburger menu. All components use responsive breakpoints with properly scaled fonts, spacing, and layouts. Toast notifications position at top-center on mobile, and the NotificationBell dropdown goes full-width. Dashboard stats use a 2-column grid on mobile, and all interactive elements are touch-optimized.

**Responsive Components (Completed - All 40+ UI components)**:
- **Core Layout**: TopBar, Sidebar, Home, AgentDashboard - Mobile drawer sidebar, responsive layouts, touch-optimized buttons
- **Notifications**: NotificationBell, Toast, CreditsOverviewCard, NotificationPreferences, Notifications Page - Mobile-optimized positioning, horizontal scrolling filters, responsive cards
- **Agent Detail**: AgentDetailClient - Responsive header with stacked layout on mobile, horizontally scrollable tabs, responsive stats grid (1 to 3 columns), all touch targets meet 44px minimum
- **Live Preview**: LivePreviewSplit - On mobile, browser viewport appears on top with 400px min-height, steps panel below; desktop maintains horizontal split (steps left, browser right). Uses flexbox order property for visual reordering. Responsive padding and text sizing throughout.
- **Agent Builder**: Complex 3-panel desktop layout (35% chat, variable flow, 30% config) converts to mobile tab interface (Chat/Flow/Config tabs) with only one panel visible at a time. Mobile tab navigation bar with 44px touch-friendly buttons. Panels use responsive widths (w-full md:w-[XX%]) for proper mobile display. Chat tab features responsive message bubbles (px-3 py-2 md:px-4 md:py-3), file uploads, and input area with 44px touch targets anchored at bottom using proper flex constraints (h-full, min-h-0, flex-shrink-0). Flow tab includes responsive ReactFlow canvas (min-h-[400px] on mobile, full height on desktop) and Deploy button. Config tab comprehensively responsive with all form inputs (min-h-[44px]), labels (text-xs md:text-sm), platform credentials, accordion sections, and horizontally scrollable tabs - all following consistent responsive patterns (px-3 md:px-4, text-xs md:text-sm)
- **Viewer Components**: SessionViewer, MemoryViewer, AuditLogsViewer, WorkflowPlan - Stacked layouts on mobile, responsive tables/grids, touch-friendly action buttons
- **Chat Components**: ChatMessagesList, GoalMessage, ChatInput, ChatMessage, StepDisplay - Responsive text sizing (text-xs → md:text-sm/base), proper spacing (p-3 → md:p-4), break-words for overflow prevention, 44px minimum touch targets
- **Browser Session**: BrowserSessionContainer, BrowserTabs, SessionControls - Responsive browser preview heights (250px → md:600px), horizontal scrolling tabs, stacked session controls on mobile
- **Utility Components**: UserProfileButton, Tooltip, Loader, ChatBlock, ValidationIndicator, AnimatedButton - Mobile-optimized dropdowns, tooltips, and loading states

**Responsive Design Achievements**: 100% of platform UI components are now fully responsive with consistent patterns (rounded-lg → md:rounded-xl, px-3 → md:px-4, text-xs → md:text-sm/base), zero business logic changes, and production-ready mobile UX meeting all industry standards (44px touch targets, no horizontal scroll, safe-area support). Architect-reviewed with zero critical issues.

**Agent Builder UX Enhancements**: Deploy button features dynamic state-aware tooltips with 4 contextual messages: (1) "Finish planning your workflow with the Planner Agent" during active planning, (2) "Complete your workflow design with the Planner Agent first" when no platforms selected, (3) "Missing credentials: Click the [Platform] node(s) to configure" with grammatically correct comma-separated lists for incomplete credentials, (4) "Launch your agent to start automating tasks" when ready. Button is properly disabled when: planning agent is working (`isLoading`), no platforms selected (`selectedPlatforms.length === 0`), or credentials incomplete. Tooltips display on disabled state via span wrapper to enable pointer events. Platform credential nodes feature visual indicators: orange pulsing borders (animate-pulse-subtle), warning badges (!) with bounce animation, orange icon backgrounds, and "Click to configure" labels for incomplete credentials; green checkmarks for completed credentials. Custom Tailwind animations include pulse-subtle (2.5s scale 1.0→1.02) and bounce-subtle (1.5s bounce 4px). Planner Agent explicitly guides users to click platform nodes to configure credentials in final message with platform-specific instructions.

### Technical Implementations
Clerk handles secure multi-user authentication with data isolation via `userId` fields in MongoDB collections and API routes. The platform supports multi-day autonomous agent campaigns, where a Master Agent API decomposes objectives into daily tasks with CUA-ready execution prompts, including mandatory PRODUCT CONTEXT. **CUA Browser Capability Guidance (Dual-Layer)**: Layer 1 - Master Agent meta-prompts explicitly require GPT-4o to include BROWSER CAPABILITIES section (section 4 of 7) in all generated task prompts, listing available actions (click, double_click, scroll, type, move, keypress, drag, wait, goto(), back()) and platform-specific navigation examples (e.g., goto("https://www.linkedin.com/")). Layer 2 - Programmatic failsafe in deploy route (`/api/agents/[id]/deploy`) performs case-insensitive check for browser capabilities and automatically prepends standardized header with platform-specific examples if missing, ensuring 100% coverage. This dual-layer approach improves CUA performance by guaranteeing explicit capability awareness and navigation guidance in every execution, reducing ambiguity and trial-and-error during browser automation. CUA authentication is optimized with granular sequences and platform-specific templates. Agent execution uses OpenAI's `computer-use-preview` model via Browserbase for real browser automation, incorporating intelligent error handling, session cleanup, Browserbase Stealth Mode, and residential proxies. **Default Browser**: All new CUA sessions start with Brave Search (https://search.brave.com) as the initial landing page, providing users with a privacy-focused search engine for their automation tasks. **Browserbase Session Reliability**: Enhanced with production-grade resilience features including keepAlive=true with 60-minute timeout for long-running campaigns, CDP connection timeout increased to 180 seconds, automatic CDP reconnection with exponential backoff (max 3 attempts with 2s/4s/8s delays), comprehensive browser/page event handlers for disconnection logging, 5-minute heartbeat monitoring with timeout warnings at 50 minutes, and action-level error boundaries that prevent single action failures from terminating sessions. **Session Resilience Against Common Failures**: Comprehensive protection against mid-execution failures including automatic URL sanitization (auto-prepends https:// to URLs missing protocol), navigation state tracking to prevent overlapping navigation requests, OpenAI API key pre-flight validation to prevent 401 errors mid-execution, enhanced 429 rate limit retry logic with aggressive exponential backoff (5s→15s→30s→60s→120s), and comprehensive error recovery with user-friendly messages for all common error types (invalid URLs, 401 unauthorized, 429 rate limits, navigation aborted, browser closed errors). The deployment flow manages `agent.isDeployed` and waits for a Browserbase session for live preview. Multi-platform authentication supports various services (Reddit, Google, LinkedIn, Salesforce, Twitter/X, Slack) and custom credentials. Persistent memory is managed via an `agent_context` table, and `session_logs` provide real-time insights. An intelligent Planner Agent uses AI to extract information, ask clarifying questions, and enforce platform selection. File uploads (PDF, TXT, XLSX) are integrated for conversational context. Performance is enhanced with screenshot caching, browser session cleanup, and production timeout configurations. Security features include Zod schemas, rate limiting, CSRF protection, structured logging, and error boundaries. The system supports both 'one-shot' and 'multi-step' execution modes for agents, allowing for single-session task completion or multi-day campaigns. A comprehensive notification system provides real-time updates on agent events, credit status, and system messages with intelligent throttling. **Credit Validation**: Pre-execution credit checking prevents agent deployment when balance is zero, displaying immediate user feedback via toast notification ("The Credits are 0 Please refill to continue") without showing loading states or triggering timeout errors. Credits are polled every 30 seconds in AgentDetailClient to maintain real-time accuracy.

### Feature Specifications
- **Natural Language Agent Creation**: Users describe sales workflows to configure agents.
- **Split-Screen Builder**: Left panel for conversational AI, right for detailed configuration (System prompt, computer-use capabilities, knowledge base, platform authentication, daily runtime limits).
- **Agent Dashboard**: Real-time monitoring, deployment controls, and performance statistics.
- **Autonomous Task Planning API**: `/api/agents/[id]/plan-tasks` for GPT-4o powered task generation.
- **Agent Detail View**: Comprehensive view with tabs for Overview, Workflow, Sessions, Memory, and Audit Logs.
- **Live Session Viewer**: Auto-refreshing view for active sessions with step-by-step logs, reasoning, and output.
- **Notification System**: Real-time notifications for agent events (task completed/failed, deployment status), credit alerts (low/exhausted), results summaries, and system updates. Features bell icon with badge count, dropdown preview, full-screen view with filtering, and intelligent throttling. Users can disable notification alerts in Settings while notifications continue to be recorded in the background.
- **Execution Modes**: One-Shot mode for single-session tasks with no runtime limits, and Multi-Step mode for multi-day campaigns with daily task decomposition.
- **Credits Overview**: A dedicated section in the Settings page providing detailed credit usage, balance, and status.
- **User Preferences**: Configurable notification preferences allowing users to disable visual alerts (badge counts) while maintaining notification history for later review.

### System Design Choices
- **Frontend**: Next.js 15, React 19, Tailwind CSS, Framer Motion.
- **Backend**: Next.js API Routes.
- **Database**: MongoDB with Mongoose ODM.
- **Browser Automation**: Browserbase + Playwright integrated with OpenAI's Computer Use API.
- **AI**: OpenAI's GPT-4o for planning and reasoning, `computer-use-preview` for browser automation.
- **State Management**: Jotai.
- **Database Architecture (MongoDB)**: All core collections include a `userId` field for multi-user isolation. Key design decisions include using MongoDB ObjectId for primary keys, application-level cascade deletes, a singleton connection pattern with connection pooling, proper indexing on frequently queried fields, and Mongoose virtuals for ID transformation. All date fields are stored as Date objects. User preferences (notification settings) are stored in `user_preferences` collection with unique userId index.

## External Dependencies

- **Database**: MongoDB
- **ODM**: Mongoose
- **Authentication**: Clerk
- **Browser Automation**: Browserbase, Playwright
- **AI Services**: OpenAI
- **Analytics**: PostHog, Vercel Analytics
- **Platform Integrations**: Reddit API, Google API, LinkedIn API, Salesforce API, Twitter/X API, Slack API